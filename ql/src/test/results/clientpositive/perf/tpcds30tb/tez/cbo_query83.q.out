CTE Suggestion:
HiveProject(d_date=[$0])
  HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
    HiveProject(d_date=[$2], d_week_seq=[$4])
      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
    HiveProject(d_week_seq=[$4])
      HiveFilter(condition=[AND(SEARCH($2, Sarg[1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE]:DATE), IS NOT NULL($4))])
        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CTE Suggestion:
HiveProject(d_date_sk=[$0], d_date=[$2])
  HiveFilter(condition=[IS NOT NULL($2)])
    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CBO PLAN:
HiveSortLimit(sort0=[$0], sort1=[$1], dir0=[ASC], dir1=[ASC], fetch=[100]): rowcount = 100.0, cumulative cost = {1.000008334078192E15 rows, 0.0 cpu, 0.0 io}, id = 132900
  HiveProject(item_id=[$0], sr_item_qty=[$1], sr_dev=[*(/(/(CAST($1):DOUBLE, CAST(+(+($1, $3), $5)):DOUBLE), 3), 100)], cr_item_qty=[$3], cr_dev=[*(/(/(CAST($3):DOUBLE, CAST(+(+($1, $3), $5)):DOUBLE), 3), 100)], wr_item_qty=[$5], wr_dev=[*(/(/($6, CAST(+(+($1, $3), $5)):DOUBLE), 3), 100)], average=[/(CAST(+(+($1, $3), $5)):DECIMAL(19, 0), 3:DECIMAL(1, 0))]): rowcount = 70193.86389527429, cumulative cost = {1.000008334078192E15 rows, 0.0 cpu, 0.0 io}, id = 132898
    HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[{379336.9961984549 rows, 0.0 cpu, 0.0 io}]): rowcount = 70193.86389527429, cumulative cost = {1.000008334078192E15 rows, 0.0 cpu, 0.0 io}, id = 132896
      HiveJoin(condition=[=($0, $2)], joinType=[inner], algorithm=[none], cost=[{495048.0 rows, 0.0 cpu, 0.0 io}]): rowcount = 131812.99619845484, cumulative cost = {1.000008333698855E15 rows, 0.0 cpu, 0.0 io}, id = 132866
        HiveProject(i_item_id=[$0], $f1=[$1]): rowcount = 247524.0, cumulative cost = {1.000008333203807E15 rows, 0.0 cpu, 0.0 io}, id = 133621
          HiveAggregate(group=[{6}], agg#0=[sum($1)]): rowcount = 247524.0, cumulative cost = {1.000008333203807E15 rows, 0.0 cpu, 0.0 io}, id = 133158
            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[{1.000000000535049E15 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {1.000008333203807E15 rows, 0.0 cpu, 0.0 io}, id = 132834
              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi]): rowcount = 1.000000000073049E15, cumulative cost = {8.332668758E9 rows, 0.0 cpu, 0.0 io}, id = 133171
                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[{8.332668758E9 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000073049E15, cumulative cost = {8.332668758E9 rows, 0.0 cpu, 0.0 io}, id = 132810
                  HiveProject(sr_item_sk=[$1], sr_return_quantity=[$9], sr_returned_date_sk=[$19]): rowcount = 8.332595709E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132803
                    HiveFilter(condition=[IS NOT NULL($19)]): rowcount = 8.332595709E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132801
                      HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns]): rowcount = 8.332595709E9, cumulative cost = {0}, id = 132354
                  HiveProject(d_date_sk=[$0], d_date=[$2]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132808
                    HiveFilter(condition=[IS NOT NULL($2)]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132806
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132360
                HiveProject(d_date=[$0]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133168
                  HiveSemiJoin(condition=[=($1, $2)], joinType=[semi]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133176
                    HiveProject(d_date=[$2], d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132815
                      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132813
                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
                    HiveProject(d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133173
                      HiveFilter(condition=[AND(SEARCH($2, Sarg[1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE]:DATE), IS NOT NULL($4))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132817
                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
              HiveProject(i_item_sk=[$0], i_item_id=[$1]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132832
                HiveTableScan(table=[[default, item]], table:alias=[item]): rowcount = 462000.0, cumulative cost = {0}, id = 132357
        HiveProject(i_item_id=[$0], $f1=[$1]): rowcount = 247524.0, cumulative cost = {1.000004321588197E15 rows, 0.0 cpu, 0.0 io}, id = 133622
          HiveAggregate(group=[{6}], agg#0=[sum($1)]): rowcount = 247524.0, cumulative cost = {1.000004321588197E15 rows, 0.0 cpu, 0.0 io}, id = 133164
            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[{1.000000000535049E15 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {1.000004321588197E15 rows, 0.0 cpu, 0.0 io}, id = 132860
              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi]): rowcount = 1.000000000073049E15, cumulative cost = {4.321053148E9 rows, 0.0 cpu, 0.0 io}, id = 133180
                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[{4.321053148E9 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000073049E15, cumulative cost = {4.321053148E9 rows, 0.0 cpu, 0.0 io}, id = 132847
                  HiveProject(cr_item_sk=[$1], cr_return_quantity=[$16], cr_returned_date_sk=[$26]): rowcount = 4.320980099E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132843
                    HiveFilter(condition=[IS NOT NULL($26)]): rowcount = 4.320980099E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132841
                      HiveTableScan(table=[[default, catalog_returns]], table:alias=[catalog_returns]): rowcount = 4.320980099E9, cumulative cost = {0}, id = 132378
                  HiveProject(d_date_sk=[$0], d_date=[$2]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132808
                    HiveFilter(condition=[IS NOT NULL($2)]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132806
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132360
                HiveProject(d_date=[$0]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133168
                  HiveSemiJoin(condition=[=($1, $2)], joinType=[semi]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133176
                    HiveProject(d_date=[$2], d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132815
                      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132813
                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
                    HiveProject(d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133173
                      HiveFilter(condition=[AND(SEARCH($2, Sarg[1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE]:DATE), IS NOT NULL($4))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132817
                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
              HiveProject(i_item_sk=[$0], i_item_id=[$1]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132832
                HiveTableScan(table=[[default, item]], table:alias=[item]): rowcount = 462000.0, cumulative cost = {0}, id = 132357
      HiveProject(item_id=[$0], wr_item_qty=[$1], EXPR$0=[CAST($1):DOUBLE]): rowcount = 247524.0, cumulative cost = {1.000002063410468E15 rows, 0.0 cpu, 0.0 io}, id = 132894
        HiveAggregate(group=[{6}], agg#0=[sum($1)]): rowcount = 247524.0, cumulative cost = {1.000002063410468E15 rows, 0.0 cpu, 0.0 io}, id = 133166
          HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[{1.000000000535049E15 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {1.000002063410468E15 rows, 0.0 cpu, 0.0 io}, id = 132888
            HiveSemiJoin(condition=[=($4, $5)], joinType=[semi]): rowcount = 1.000000000073049E15, cumulative cost = {2.062875419E9 rows, 0.0 cpu, 0.0 io}, id = 133184
              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[{2.062875419E9 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000073049E15, cumulative cost = {2.062875419E9 rows, 0.0 cpu, 0.0 io}, id = 132875
                HiveProject(wr_item_sk=[$1], wr_return_quantity=[$13], wr_returned_date_sk=[$23]): rowcount = 2.06280237E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132871
                  HiveFilter(condition=[IS NOT NULL($23)]): rowcount = 2.06280237E9, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132869
                    HiveTableScan(table=[[default, web_returns]], table:alias=[web_returns]): rowcount = 2.06280237E9, cumulative cost = {0}, id = 132404
                HiveProject(d_date_sk=[$0], d_date=[$2]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132808
                  HiveFilter(condition=[IS NOT NULL($2)]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132806
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132360
              HiveProject(d_date=[$0]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133168
                HiveSemiJoin(condition=[=($1, $2)], joinType=[semi]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133176
                  HiveProject(d_date=[$2], d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132815
                    HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132813
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
                  HiveProject(d_week_seq=[$4]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 133173
                    HiveFilter(condition=[AND(SEARCH($2, Sarg[1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE]:DATE), IS NOT NULL($4))]): rowcount = 73049.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132817
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 132364
            HiveProject(i_item_sk=[$0], i_item_id=[$1]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 132832
              HiveTableScan(table=[[default, item]], table:alias=[item]): rowcount = 462000.0, cumulative cost = {0}, id = 132357

