CTE Suggestion:
HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[not available])
  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)])
    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))])
      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)])
        HiveFilter(condition=[=($6, 410)])
          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1])
  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)])
    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))])
      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)])
        HiveProject($f0=[true], $f1=[$21])
          HiveFilter(condition=[AND(=($6, 410), IS NULL($4))])
            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])

Warning: Map Join MAPJOIN[112][bigTable=?] in task 'Reducer 2' is a cross product
CBO PLAN:
HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[100]): rowcount = 100.0, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 58042
  HiveProject(rnk=[$3], best_performing=[$1], worst_performing=[$7]): rowcount = 1.000000000462E15, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 58041
    HiveJoin(condition=[=($6, $4)], joinType=[inner], algorithm=[none], cost=[{1.000000000924E15 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 58040
      HiveJoin(condition=[=($0, $2)], joinType=[inner], algorithm=[none], cost=[{462534.30916703545 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {463336.7074428975 rows, 0.0 cpu, 0.0 io}, id = 58039
        HiveProject(i_item_sk=[$0], i_product_name=[$21]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57538
          HiveTableScan(table=[[default, item]], table:alias=[i1]): rowcount = 462000.0, cumulative cost = {0}, id = 57329
        HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{320.55931034482757 rows, 0.0 cpu, 0.0 io}]): rowcount = 534.3091670354205, cumulative cost = {802.3982758620689 rows, 0.0 cpu, 0.0 io}, id = 58038
          HiveProject(item_sk=[$0], rank_window_0=[$1]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58043
            HiveFilter(condition=[<($1, 11)]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58028
              HiveProject(item_sk=[$0], rank_window_0=[rank() OVER (PARTITION BY 0 ORDER BY $1 NULLS LAST RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58027
                HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[{481.8389655172414 rows, 0.0 cpu, 0.0 io}]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58026
                  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57549
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57547
                      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)]): rowcount = 464811.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57743
                        HiveFilter(condition=[=($6, 410)]): rowcount = 9.93159671E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57541
                          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 57284
                  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58025
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58024
                      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58023
                        HiveProject($f0=[true], $f1=[$21]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58022
                          HiveFilter(condition=[AND(IS NULL($4), =($6, 410))]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58021
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 57293
          HiveProject(item_sk=[$0], rank_window_0=[$1]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58044
            HiveFilter(condition=[<($1, 11)]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58037
              HiveProject(item_sk=[$0], rank_window_0=[rank() OVER (PARTITION BY 0 ORDER BY $1 DESC NULLS FIRST RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58036
                HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[{481.8389655172414 rows, 0.0 cpu, 0.0 io}]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 58035
                  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57549
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57547
                      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)]): rowcount = 464811.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57743
                        HiveFilter(condition=[=($6, 410)]): rowcount = 9.93159671E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57541
                          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 57284
                  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58034
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58033
                      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58032
                        HiveProject($f0=[true], $f1=[$21]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58031
                          HiveFilter(condition=[AND(IS NULL($4), =($6, 410))]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 58030
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 57293
      HiveProject(i_item_sk=[$0], i_product_name=[$21]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57588
        HiveTableScan(table=[[default, item]], table:alias=[i2]): rowcount = 462000.0, cumulative cost = {0}, id = 57332

