CTE Suggestion:
HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[not available])
  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)])
    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))])
      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)])
        HiveFilter(condition=[=($6, 410)])
          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1])
  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)])
    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))])
      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)])
        HiveProject($f0=[true], $f1=[$21])
          HiveFilter(condition=[AND(=($6, 410), IS NULL($4))])
            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])

Warning: Map Join MAPJOIN[112][bigTable=?] in task 'Reducer 2' is a cross product
CBO PLAN:
HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[100]): rowcount = 100.0, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 57513
  HiveProject(rnk=[$3], best_performing=[$1], worst_performing=[$7]): rowcount = 1.000000000462E15, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 57512
    HiveJoin(condition=[=($6, $4)], joinType=[inner], algorithm=[none], cost=[{1.000000000924E15 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {1.0000000013873368E15 rows, 0.0 cpu, 0.0 io}, id = 57511
      HiveJoin(condition=[=($0, $2)], joinType=[inner], algorithm=[none], cost=[{462534.30916703545 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.000000000462E15, cumulative cost = {463336.7074428975 rows, 0.0 cpu, 0.0 io}, id = 57510
        HiveProject(i_item_sk=[$0], i_product_name=[$21]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57009
          HiveTableScan(table=[[default, item]], table:alias=[i1]): rowcount = 462000.0, cumulative cost = {0}, id = 56800
        HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{320.55931034482757 rows, 0.0 cpu, 0.0 io}]): rowcount = 534.3091670354205, cumulative cost = {802.3982758620689 rows, 0.0 cpu, 0.0 io}, id = 57509
          HiveProject(item_sk=[$0], rank_window_0=[$1]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57514
            HiveFilter(condition=[<($1, 11)]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57499
              HiveProject(item_sk=[$0], rank_window_0=[rank() OVER (PARTITION BY 0 ORDER BY $1 NULLS LAST RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57498
                HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[{481.8389655172414 rows, 0.0 cpu, 0.0 io}]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57497
                  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57020
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57018
                      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)]): rowcount = 464811.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57214
                        HiveFilter(condition=[=($6, 410)]): rowcount = 9.93159671E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57012
                          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 56755
                  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57496
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57495
                      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57494
                        HiveProject($f0=[true], $f1=[$21]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57493
                          HiveFilter(condition=[AND(IS NULL($4), =($6, 410))]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57492
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 56764
          HiveProject(item_sk=[$0], rank_window_0=[$1]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57515
            HiveFilter(condition=[<($1, 11)]): rowcount = 160.27965517241378, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57508
              HiveProject(item_sk=[$0], rank_window_0=[rank() OVER (PARTITION BY 0 ORDER BY $1 DESC NULLS FIRST RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57507
                HiveJoin(condition=[>($1, *(0.9:DECIMAL(1, 1), $2))], joinType=[inner], algorithm=[none], cost=[{481.8389655172414 rows, 0.0 cpu, 0.0 io}]): rowcount = 480.8389655172414, cumulative cost = {481.8389655172414 rows, 0.0 cpu, 0.0 io}, id = 57506
                  HiveProject($f0=[$0], $f1=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57020
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 480.8389655172414, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57018
                      HiveAggregate(group=[{1}], agg#0=[sum($21)], agg#1=[count($21)]): rowcount = 464811.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57214
                        HiveFilter(condition=[=($6, 410)]): rowcount = 9.93159671E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57012
                          HiveTableScan(table=[[default, store_sales]], table:alias=[ss1]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 56755
                  HiveProject(rank_col=[CAST(/($1, $2)):DECIMAL(11, 6)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57505
                    HiveFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57504
                      HiveAggregate(group=[{0}], agg#0=[sum($1)], agg#1=[count($1)]): rowcount = 1.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57503
                        HiveProject($f0=[true], $f1=[$21]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57502
                          HiveFilter(condition=[AND(IS NULL($4), =($6, 410))]): rowcount = 13746.154615916956, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57501
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.6404891377E10, cumulative cost = {0}, id = 56764
      HiveProject(i_item_sk=[$0], i_product_name=[$21]): rowcount = 462000.0, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 57059
        HiveTableScan(table=[[default, item]], table:alias=[i2]): rowcount = 462000.0, cumulative cost = {0}, id = 56803

