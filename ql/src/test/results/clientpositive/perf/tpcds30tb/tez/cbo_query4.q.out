CTE Suggestion:
HiveProject(cs_bill_customer_sk=[$2], cs_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))])
  HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($33))])
    HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])

CTE Suggestion:
HiveProject(d_date_sk=[$0])
  HiveFilter(condition=[=($6, 1999)])
    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CTE Suggestion:
HiveProject(d_date_sk=[$0])
  HiveFilter(condition=[=($6, 2000)])
    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CTE Suggestion:
HiveProject(ss_customer_sk=[$2], ss_sold_date_sk=[$22], $f8=[/(+(-(-($16, $15), $13), $14), 2:DECIMAL(10, 0))])
  HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))])
    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])

CTE Suggestion:
HiveProject(ws_bill_customer_sk=[$3], ws_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))])
  HiveFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($33))])
    HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])

CBO PLAN:
HiveSortLimit(sort0=[$0], sort1=[$1], sort2=[$2], sort3=[$3], dir0=[ASC], dir1=[ASC], dir2=[ASC], dir3=[ASC], fetch=[100]): rowcount = 1.517656965028013, cumulative cost = {8.129087571535373E10 rows, 0.0 cpu, 0.0 io}, id = 53070
  HiveProject(customer_id=[$13], customer_first_name=[$14], customer_last_name=[$15], customer_birth_country=[$16]): rowcount = 1.517656965028013, cumulative cost = {8.129087571535373E10 rows, 0.0 cpu, 0.0 io}, id = 53537
    HiveJoin(condition=[AND(=($13, $2), CASE($4, CASE($10, >(/($1, $9), /($17, $3)), false), false))], joinType=[inner], algorithm=[none], cost=[{8.000000148110303E7 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.517656965028013, cumulative cost = {8.129087571535373E10 rows, 0.0 cpu, 0.0 io}, id = 53064
      HiveJoin(condition=[AND(=($2, $11), CASE($7, CASE($10, >(/($1, $9), /($12, $6)), false), false))], joinType=[inner], algorithm=[none], cost=[{8.000000108869965E7 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.4811030281857052, cumulative cost = {8.121087571387262E10 rows, 0.0 cpu, 0.0 io}, id = 53047
        HiveJoin(condition=[=($2, $0)], joinType=[inner], algorithm=[none], cost=[{8.0000001E7 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.0886996462956955, cumulative cost = {8.113087571278392E10 rows, 0.0 cpu, 0.0 io}, id = 53028
          HiveProject(c_customer_id=[$0], $f1=[$1]): rowcount = 8.0E7, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 54069
            HiveAggregate(group=[{5}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 53527
              HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{2.9557483991457283E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 52949
                HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{4.28993935100804E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 2.1557483991457286E8, cumulative cost = {4.28993935100804E10 rows, 0.0 cpu, 0.0 io}, id = 52944
                  HiveProject(cs_bill_customer_sk=[$2], cs_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))]): rowcount = 4.2899393143E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52937
                    HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($33))]): rowcount = 4.2899393143E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52935
                      HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales]): rowcount = 4.3005109025E10, cumulative cost = {0}, id = 52079
                  HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52942
                    HiveFilter(condition=[=($6, 2000)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52940
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
                HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
                  HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033
          HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[{2.0 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.0, cumulative cost = {8.105087571178392E10 rows, 0.0 cpu, 0.0 io}, id = 53026
            HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[{2.0 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.0, cumulative cost = {8.105087570978392E10 rows, 0.0 cpu, 0.0 io}, id = 53005
              HiveProject(customer_id=[$0], year_total=[$1], EXPR$131=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 52981
                HiveFilter(condition=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 52979
                  HiveAggregate(group=[{5}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 53515
                    HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{4.848543767035176E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 52971
                      HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{8.05660213310804E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 4.048543767035176E8, cumulative cost = {8.05660213310804E10 rows, 0.0 cpu, 0.0 io}, id = 52968
                        HiveProject(ss_customer_sk=[$2], ss_sold_date_sk=[$22], $f8=[/(+(-(-($16, $15), $13), $14), 2:DECIMAL(10, 0))]): rowcount = 8.0566020964E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52962
                          HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))]): rowcount = 8.0566020964E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52960
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.2510879939E10, cumulative cost = {0}, id = 52036
                        HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52966
                          HiveFilter(condition=[=($6, 1999)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52964
                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
                      HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
                        HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033
              HiveProject(customer_id=[$0], year_total=[$1], EXPR$0=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 53003
                HiveFilter(condition=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 53001
                  HiveAggregate(group=[{5}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 53519
                    HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{1.885022352361809E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 52993
                      HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{2.1591945179080402E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.085022352361809E8, cumulative cost = {2.1591945179080402E10 rows, 0.0 cpu, 0.0 io}, id = 52990
                        HiveProject(ws_bill_customer_sk=[$3], ws_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))]): rowcount = 2.1591944812E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52986
                          HiveFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($33))]): rowcount = 2.1591944812E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52984
                            HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales]): rowcount = 2.1594638446E10, cumulative cost = {0}, id = 52124
                        HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52966
                          HiveFilter(condition=[=($6, 1999)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52964
                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
                      HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
                        HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033
            HiveProject(customer_id=[$0], year_total=[$1], EXPR$1=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 53024
              HiveFilter(condition=[>($1, 0:DECIMAL(1, 0))]): rowcount = 1.0, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 53022
                HiveAggregate(group=[{5}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 53523
                  HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{2.9557483991457283E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {4.319496834999497E10 rows, 0.0 cpu, 0.0 io}, id = 53014
                    HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{4.28993935100804E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 2.1557483991457286E8, cumulative cost = {4.28993935100804E10 rows, 0.0 cpu, 0.0 io}, id = 53011
                      HiveProject(cs_bill_customer_sk=[$2], cs_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))]): rowcount = 4.2899393143E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52937
                        HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($33))]): rowcount = 4.2899393143E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52935
                          HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales]): rowcount = 4.3005109025E10, cumulative cost = {0}, id = 52079
                      HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52966
                        HiveFilter(condition=[=($6, 1999)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52964
                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
                    HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
                      HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033
        HiveProject(c_customer_id=[$0], $f1=[$1]): rowcount = 8.0E7, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 54070
          HiveAggregate(group=[{5}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 53531
            HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{1.885022352361809E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {2.178044741431658E10 rows, 0.0 cpu, 0.0 io}, id = 53037
              HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{2.1591945179080402E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.085022352361809E8, cumulative cost = {2.1591945179080402E10 rows, 0.0 cpu, 0.0 io}, id = 53034
                HiveProject(ws_bill_customer_sk=[$3], ws_sold_date_sk=[$33], $f8=[/(+(-(-($24, $23), $21), $22), 2:DECIMAL(10, 0))]): rowcount = 2.1591944812E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52986
                  HiveFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($33))]): rowcount = 2.1591944812E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52984
                    HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales]): rowcount = 2.1594638446E10, cumulative cost = {0}, id = 52124
                HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52942
                  HiveFilter(condition=[=($6, 2000)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52940
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
              HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
                HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033
      HiveProject(c_customer_id=[$0], c_first_name=[$1], c_last_name=[$2], c_birth_country=[$3], $f4=[$4]): rowcount = 8.0E7, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 54071
        HiveAggregate(group=[{5, 6, 7, 9}], agg#0=[sum($2)]): rowcount = 8.0E7, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 53535
          HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[{4.848543767035176E8 rows, 0.0 cpu, 0.0 io}]): rowcount = 1.00000008E15, cumulative cost = {8.105087570778392E10 rows, 0.0 cpu, 0.0 io}, id = 53056
            HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[{8.05660213310804E10 rows, 0.0 cpu, 0.0 io}]): rowcount = 4.048543767035176E8, cumulative cost = {8.05660213310804E10 rows, 0.0 cpu, 0.0 io}, id = 53053
              HiveProject(ss_customer_sk=[$2], ss_sold_date_sk=[$22], $f8=[/(+(-(-($16, $15), $13), $14), 2:DECIMAL(10, 0))]): rowcount = 8.0566020964E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52962
                HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))]): rowcount = 8.0566020964E10, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52960
                  HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales]): rowcount = 8.2510879939E10, cumulative cost = {0}, id = 52036
              HiveProject(d_date_sk=[$0]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52942
                HiveFilter(condition=[=($6, 2000)]): rowcount = 367.08040201005025, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52940
                  HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim]): rowcount = 73049.0, cumulative cost = {0}, id = 52042
            HiveProject(c_customer_sk=[$0], c_customer_id=[$1], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10], c_birth_country=[$14], c_login=[$15], c_email_address=[$16]): rowcount = 8.0E7, cumulative cost = {0.0 rows, 0.0 cpu, 0.0 io}, id = 52947
              HiveTableScan(table=[[default, customer]], table:alias=[customer]): rowcount = 8.0E7, cumulative cost = {0}, id = 52033

